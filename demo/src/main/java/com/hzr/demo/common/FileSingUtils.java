package com.hzr.demo.common;import org.apache.commons.io.FileUtils;import org.ofdrw.core.basicStructure.pageObj.Page;import org.ofdrw.gm.cert.PKCS12Tools;import org.ofdrw.gm.ses.v4.SESeal;import org.ofdrw.reader.OFDReader;import org.ofdrw.sign.OFDSigner;import org.ofdrw.sign.SignMode;import org.ofdrw.sign.signContainer.SESV4Container;import org.ofdrw.sign.stamppos.NormalStampPos;import org.ofdrw.sign.verify.OFDValidator;import org.ofdrw.sign.verify.container.SESV4ValidateContainer;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;import java.io.File;import java.io.IOException;import java.nio.file.Files;import java.nio.file.Path;import java.nio.file.Paths;import java.security.GeneralSecurityException;import java.security.PrivateKey;import java.security.cert.Certificate;/** * @Classname FileSingUtils * @Author: hzr * @Description TODO * @Version 1.0.0 * @Date 2023/12/6 11:24 * @Created by 22906 */@Componentpublic class FileSingUtils {    @Autowired    private BaseConfig baseConfig;    public void setFileSing(File fromPath, File toPath, Integer page, Double x, Double y) throws GeneralSecurityException, IOException {        OFDReader getofdxy = new OFDReader(fromPath.getPath());        Page setpage = getofdxy.getPage(1);//        setpage.getArea().getApplicationBox().getHeight();//        setpage.getArea().getApplicationBox().getWidth();        Double width = setpage.getArea().getPhysicalBox().getWidth();        Double height = setpage.getArea().getPhysicalBox().getHeight();        Double x1 = width * (x / 100.0);        Double y1 = height * (y / 100.0);        Path userP12Path = Paths.get(baseConfig.getUserP12Path(), "USER.p12");        Path sealPath = Paths.get(baseConfig.getUserEslPath(), "UserV4.esl");        PrivateKey prvKey = PKCS12Tools.ReadPrvKey(userP12Path, "private", "777777");        Certificate signCert = PKCS12Tools.ReadUserCert(userP12Path, "private", "777777");        SESeal seal = SESeal.getInstance(Files.readAllBytes(sealPath));        Path src = Paths.get(fromPath.getPath());        Path out = Paths.get(toPath.getPath());        // 1. 构造签名引擎        try (OFDReader reader = new OFDReader(src);//             OFDSigner signer = new OFDSigner(reader, out, new NumberFormatAtomicSignID())             OFDSigner signer = new OFDSigner(reader, out);        ) {            SESV4Container signContainer = new SESV4Container(prvKey, seal, signCert);            // 2. 设置签名模式            signer.setSignMode(SignMode.ContinueSign);            // 3. 设置签名使用的扩展签名容器            signer.setSignContainer(signContainer);            // 4. 设置显示位置            signer.addApPos(new NormalStampPos(page, x1, y1, 40, 40));            // 5. 执行签名            signer.exeSign();            // 6. 关闭签名引擎，生成文档。        }//         验证        try (OFDReader reader = new OFDReader(out);             OFDValidator validator = new OFDValidator(reader)) {            validator.setValidator(new SESV4ValidateContainer());            validator.exeValidate();            System.out.println(">> 验证通过");        }        FileUtils.copyFile(toPath, fromPath);    }}