package com.hzr.demo.signController;import com.hzr.demo.common.FileSingUtils;import com.hzr.demo.entity.FileEntity;import com.hzr.demo.service.FileService;import org.apache.commons.io.FileUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.core.io.InputStreamResource;import org.springframework.http.HttpHeaders;import org.springframework.http.MediaType;import org.springframework.http.ResponseEntity;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.multipart.MultipartFile;import java.io.File;import java.io.FileInputStream;import java.io.IOException;import java.util.List;import java.util.Optional;/** * @Classname demoController * @Author: hzr * @Description TODO * @Version 1.0.0 * @Date 2023/12/6 10:56 * @Created by 22906 */@Controllerpublic class demoController {    @Autowired    private FileService fileService;    @RequestMapping("/view")    public String index(Model model) {        List<FileEntity> all = fileService.findAll();        model.addAttribute("data",all);//        model.addAttribute("data","SpringBoot 成功集成 Thymeleaf 模版！");        return "index";    }    @RequestMapping("/upload")    public String upload(MultipartFile file, Model model) throws IOException {        FileEntity fileEntity = new FileEntity();        String fileName = file.getOriginalFilename();        File dest = new File("E:\\upload_pdfjs\\ofd_file\\signfile\\" + fileName);        File to = new File("E:\\upload_pdfjs\\ofd_file\\sign\\" + fileName);        FileUtils.copyInputStreamToFile(file.getInputStream(), dest);        try {            System.out.println(dest.getPath());            FileSingUtils.setFileSing(dest,to);        } catch (Exception e) {            throw new RuntimeException(e);        }        fileEntity.setFileName(fileName);        fileEntity.setFilePath(to.getPath());        fileService.save(fileEntity);        List<FileEntity> all = fileService.findAll();        model.addAttribute("data",all);        return "redirect:/view";    }    @GetMapping(value = "/download/{id}")    public ResponseEntity<InputStreamResource> download(@PathVariable String id) throws IOException {        FileEntity byId = fileService.findById(id);        File file = new File(byId.getFilePath());        MediaType mediaType = MediaType.parseMediaType("application/pdf");        InputStreamResource resource = new InputStreamResource(new FileInputStream(file));        return ResponseEntity.ok()                .header(HttpHeaders.CONTENT_DISPOSITION, "attachment;filename=" + file.getName())                .contentType(mediaType)                .contentLength(file.length())                .body(resource);    }//    @GetMapping(value = "/findid/{id}")//    @ResponseBody//    public Optional<FileEntity> find(@PathVariable String id) throws IOException {//        return fileService.findById(id);//    }}